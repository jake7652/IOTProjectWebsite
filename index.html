<head>
</head>
<body>

<p>
Lol ok
</p>
<div id="separator" style="width:100%;height:5px;"></div>
<script src="plotly-latest.min.js"></script>
<script src="jquery-3.3.1.js"></script>
<div id="myDiv" style="width:100%;height:400px;"></div>
<script>


function getFromSql(field,lines,async) {
var ret = null;
$.ajax({ url: "sqlReq.php",
         async: async,
	 type: "POST",
         dataType: 'json',
	 data: {arguments: [field,lines]},
         success: function(output) {
		    ret = output;
		    
                  }
		
});
return ret;
}
var query = getFromSql("PressureTemperature","20",false);
var temps = query.data;
var dates = query.time;
var maxDate = dates[dates.length-1];
var maxTemp = 0;
for(var i = 0; i < dates.length; i++) {
if(temps[i] > maxTemp) {
maxTemp = temps[i];
}
var tempDate = "";
tempDate = tempDate.concat (dates[i].substring(0,4), "-" , dates[i].substring(4,6) ,"-" , dates[i].substring(6,8) ," " ,dates[i].substring(8,10) ,":" 
,dates[i].substring(10,12) ,":" ,dates[i].substring(12,14));
dates[i] = tempDate;
}
//alert(temps.length);
var trace1 = {
  x: dates,
  y: temps,
  type: 'scatter',
  mode: 'lines',
  
};

var data = [ trace1 ];

var layout = {
  xaxis: {
    type: 'date',
    autorange: true,
    autoscale: false,
    rangeselector: {buttons: [
    { count: 1,
    label: '1d',
    step: 'day',
    stepmode: 'backward'
    },
    { count: 7,
    label: '1w',
    step: 'day',
    stepmode: 'backward'
    },
    {
    count: 1,
    label: '1m',
    step: 'month',
    stepmode: 'backward'
    },
    {step: 'all'}
    ]},
    title: 'Date',
    //range ['2000-01-12', '2000-01-13']
  },
  yaxis: {
    title: 'Temperature',
    range: [0,(parseInt(maxTemp)+20)], 
    autoscale: false
  },
  title:'Pressure Temperature'
};

Plotly.plot('myDiv', data,layout);


function getFromSqlUpdater(field,lines,async) {

$.ajax({ url: "sqlReq.php",
         async: async,
	 type: "POST",
         dataType: 'json',
	 data: {arguments: [field,lines]},
         success: function(output) {
	 //alert("REQUEST");
	 var newTemps = output.data;	 
	 var newDates = output.time;
	 var update = false;
	 var x_update = new Array();
	 var y_update = new Array();
	 for(var i = 0; i < newDates.length; i++){
	 if(parseInt(newDates[i]) > parseInt(maxDate)) {
	maxDate = newDates[i];
	 update = true;
	 var tempDate = "";
	 tempDate = tempDate.concat (newDates[i].substring(0,4), "-" , newDates[i].substring(4,6) ,"-" , newDates[i].substring(6,8) ," " ,newDates[i].substring(8,10) ,":" 
	 ,newDates[i].substring(10,12) ,":" ,newDates[i].substring(12,14));
	 x_update[x_update.length] = tempDate;
	 y_update[y_update.length] = newTemps[i]; 
	}
	}
	if(update == true) {
	//alert(x_update);
	//alert(y_update);
	var updated_points = {
	x: [x_update],
	y: [y_update],
	

	} 
	Plotly.extendTraces('myDiv',updated_points,[0]);
	
	}
                  }
		
});
	
return ret;
}

var cnt = 0;
var interval = setInterval(function() {
getFromSqlUpdater("PressureTemperature","15",true);
if(cnt==100) { clearInterval(interval); }

},10000);






</script>

<div id="myDiv2" style="width:100%;height:400px;"></div>





</body>